<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Comments from Google Sheet</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; }
  .comment { border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; border-radius: 6px; }
  .comment .name { font-weight: bold; }
  .comment .time { font-size: 0.85rem; color: #666; }
  .comment .text { margin-top: 0.5rem; }
</style>
</head>
<body>

<h1>Comments</h1>
<div id="commentsContainer">Loading comments...</div>

<script>
  const endpoint = 'https://script.google.com/macros/s/AKfycbz01Ac6rV8IV1qlDDtkX-DyQw2n4hxqjhUZKo5Av4zxY6O1fOJgzKemJpQcZ2TxHt2_4Q/exec';

  // Sanitize text to avoid HTML injection
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // Format timestamp (if valid)
  function formatTimestamp(ts) {
    let date = new Date(ts);
    if (isNaN(date)) return ts || '';
    return date.toLocaleString();
  }

  async function loadComments() {
    try {
      const res = await fetch(endpoint);
      if (!res.ok) throw new Error('Network response was not ok');

      const data = await res.json();

      if (!Array.isArray(data) || data.length === 0) {
        document.getElementById('commentsContainer').innerText = 'No comments yet.';
        return;
      }

      const container = document.getElementById('commentsContainer');
      container.innerHTML = ''; // Clear loading

      data.forEach(comment => {
        const div = document.createElement('div');
        div.className = 'comment';
        div.innerHTML = `
          <div class="name">${escapeHtml(comment.name || 'Anonymous')}</div>
          <div class="time">${formatTimestamp(comment.ts)}</div>
          <div class="text">${escapeHtml(comment.text)}</div>
        `;
        container.appendChild(div);
      });

    } catch (err) {
      document.getElementById('commentsContainer').innerText = 'Failed to load comments.';
      console.error('Error loading comments:', err);
    }
  }

  loadComments();
</script>

</body>
</html>
